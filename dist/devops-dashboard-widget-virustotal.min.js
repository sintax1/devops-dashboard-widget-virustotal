!function(o,r){"use strict";angular.module("DevopsDashboard.widget.virustotal",["adf.provider","angularFileUpload"]).value("virusTotalUrl","/proxy/https://www.virustotal.com/vtapi/v2").config(["dashboardProvider",function(o){o.widget("virustotal",{title:"VirusTotal",description:"VirusTotal API Interface",authorizedGroups:["root9B root9b_all"],controller:"virusTotalCtrl",templateUrl:"{widgetsPath}/virustotal/src/view.html",edit:{templateUrl:"{widgetsPath}/virustotal/src/edit.html"}})}]).service("virusTotalService",["$q","$http","virusTotalUrl",function(o,r,e){return{ipReport:function(o,t){var i=e+"/ip-address/report",a={params:{apikey:o,ip:t}};return r.get(i,a)},domainReport:function(o,t){var i=e+"/domain/report",a={params:{apikey:o,domain:t}};return r.get(i,a)},urlScan:function(o,t){var i=e+"/url/report",a={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}},l=$.param({apikey:o,resource:t,scan:1});return r.post(i,l,a)}}}]).controller("virusTotalCtrl",["$scope","$http","config","virusTotalUrl","virusTotalService","FileUploader","Logger",function(o,r,e,t,i,a,l){o.virusTotalUrl=t,o.output="",o.domain="root9b.com",o.url="http://www.root9b.com",o.ip="107.170.97.60",o.upload_progress=null;var n=l,s=o.uploader=new a({formData:[{apikey:e.apikey}]});s.onWhenAddingFileFailed=function(o,r,e){console.info("onWhenAddingFileFailed",o,r,e)},s.onAfterAddingFile=function(r){r.upload(),o.upload_progress=0},s.onProgressItem=function(r,e){o.upload_progress=e},s.onSuccessItem=function(r,e,t,i){o.output=e,n.info({service:"VirusTotal",command:"fileScan",data:e}),o.upload_progress=null},s.onErrorItem=function(r,e,t,i){console.info("onErrorItem",r,e,t,i),n.error({service:"VirusTotal",command:"fileScan",data:e}),o.upload_progress=null},o.domainReport=function(){if(!e.apikey)return o.output="Missing API Key. See Widget settings.",void n.error({service:"VirusTotal",command:"domainReport",data:"Missing API Key. See Widget settings."});var r=i.domainReport(e.apikey,o.domain);r.then(function(r){o.output=r.data,n.info({service:"VirusTotal",command:"domainReport",data:r.data})},function(r){o.output=r,n.error({service:"VirusTotal",command:"domainReport",data:r})})},o.urlScan=function(){if(!e.apikey)return o.output="Missing API Key. See Widget settings.",void n.error({service:"VirusTotal",command:"urlScan",data:"Missing API Key. See Widget settings."});var r=i.urlScan(e.apikey,o.url);r.then(function(r){o.output=r.data},function(r){o.output=r,n.error({service:"VirusTotal",command:"urlScan",data:r})})},o.ipReport=function(){if(!e.apikey)return o.output="Missing API Key. See Widget settings.",void n.error({service:"VirusTotal",command:"ipReport",data:"Missing API Key. See Widget settings."});var r=i.ipReport(e.apikey,o.ip);r.then(function(r){console.log("Success: ",r),o.output=r.data},function(r){console.log("Failed: ",r),o.output=r,n.error({service:"VirusTotal",command:"ipReport",data:r})})}}]),angular.module("DevopsDashboard.widget.virustotal").run(["$templateCache",function(o){o.put("{widgetsPath}/virustotal/src/edit.html",'<form role=form><div class=form-group><label for=apikey>VirusTotal API Key</label> <input type=text class=form-control id=apikey ng-model=config.apikey placeholder="Enter VirusTotal API Key"></div></form>'),o.put("{widgetsPath}/virustotal/src/view.html",'<style>\n    .my-drop-zone { border: dotted 3px lightgray; }\n    .nv-file-over { border: dotted 3px red; } /* Default class applied to drop zones on over */\n    .another-file-over-class { border: dotted 3px green; }\n    html, body { height: 100%; }\n</style><div><label for=domain>Domain Report</label><form role=form><div class=form-group><input type=text class=form-control id=domain ng-model=domain placeholder="Enter a domain"> <button ng-click=domainReport()>Submit</button></div></form><label for=domain>IP Scan</label><form role=form><div class=form-group><input type=text class=form-control id=ip ng-model=ip placeholder="Enter an IP Address"> <button ng-click=ipReport()>Submit</button></div></form><label for=url>URL Scan</label><form role=form><div class=form-group><input type=text class=form-control id=url ng-model=url placeholder="Enter a url"> <button ng-click=urlScan()>Submit</button></div></form><label for=upload>File Upload</label> <input id=upload type=file nv-file-select uploader=uploader options="{ url: \'{{virusTotalUrl}}/file/scan\' }"><br><div nv-file-drop uploader=uploader options="{ url: \'{{virusTotalUrl}}/file/scan\' }"><div nv-file-over uploader=uploader over-class=another-file-over-class class="well my-drop-zone">Drop a file here to scan</div></div><div ng-if=upload_progress class=progress><div class="progress-bar progress-bar-info progress-bar-striped active" role=progressbar aria-valuenow={{upload_progress}} aria-valuemin=0 aria-valuemax=100 style="width: {{upload_progress}}%"><span class=sr-only>{{upload_progress}}% Complete</span></div></div><pre>{{output | json}}</pre></div>')}])}(window);